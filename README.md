# MM2 Offset Validation Summary Tool
The MM2 Offset Validation Summary tool can be used to provide a summary (pivot table) of the CSV output file generated by the [MM2 Validation Tool](https://github.com/aiven/aiven-examples/blob/main/solutions/mm2-migration-external-k8s-kafka/mm2-offset-consumer-groups-validation/README.md). To run the summary tool, you simply need to have Python >= 3.7 installed and run the following commands:

## Step 1) Clone the repo and install dependencies:

```commandline
git clone https://github.com/bruno-faria-aiven/mm2-offset-validation-summary.git
cd mm2-offset-validation-summary/
pip install -r requirements.txt
```

## Step 2) Build the package:

```commandline
python -m build
```
This will create a dist/ directory containing .tar.gz and .whl files.

## Step 3) Install the package locally:

```commandline
pip install .
```
This command installs your package in the current environment.

## Step 4) Run the Package from the Command Line

After installing the package, you can run your application using the command defined in pyproject.toml (run_offset_validation_summary):
```commandline
run_offset_validation_summary CSV_PATH
```
This will execute the main() function from mm2_offset_validation_summary/offset_validation_summary.py and print the results to your screen/console. The tool will also create a CSV file named pivot_table_summary.csv containing the pivot table with the MM2 offset validation summary. 

### Example execution of the offset summary tool:
First run the steps above to build and install the tool locally. You can then run the tool command (run_offset_validation_summary CSV_PATH) which will produce results similar to the following:

```commandline
$ run_offset_validation_summary mm2-offset-details.csv
GROUP STATE                                                                                                              Empty        Stable Total messages
IS OK                                                                                                                    False   True   True
Target consumer group missing the topic partition. Source partition is empty therefore offset not expected to be synced.     0  15640   6268          21908
Target consumer group missing the topic partition. Source partition not empty therefore offset expected to be synced.     1860      0      0           1860
Target has offset sync.                                                                                                      0  15864  12708          28572
Grand Total                                                                                                               1860  31504  18976          52340
```

The tool will also produce the CSV file with the same results as above:
```commandline
$ cat pivot_table_summary.csv
GROUP STATE,Empty,Empty,Stable,Total messages
IS OK,False,True,True,
Target consumer group missing the topic partition. Source partition is empty therefore offset not expected to be synced.,0,15640,6268,21908
Target consumer group missing the topic partition. Source partition not empty therefore offset expected to be synced.,1860,0,0,1860
Target has offset sync.,0,15864,12708,28572
Grand Total,1860,31504,18976,52340
```